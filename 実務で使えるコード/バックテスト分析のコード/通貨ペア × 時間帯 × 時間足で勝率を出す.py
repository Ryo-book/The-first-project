#参考　データサイエンスハンドブック P185

import pandas as pd

# -------------------------
# 1) CSV読み込み
# -------------------------
df = pd.read_csv("backtest.csv")

# -------------------------
# 2) timestamp を datetime に変換
# -------------------------
df["timestamp"] = pd.to_datetime(df["timestamp"])

# -------------------------
# 3) hour を作る
# -------------------------
df["hour"] = df["timestamp"].dt.hour

# -------------------------
# 4) hour をカテゴリに分ける
#    21〜23を作るための切り分け
# -------------------------
hour_cat = pd.cut(df["hour"], [0, 6, 12, 18, 21, 23, 24])

# -------------------------
# 5) ピボットテーブル作成
# -------------------------
result = df.pivot_table(
    values="win",                 # 勝ち(1/0)
    index=["symbol", hour_cat],   # 行：通貨ペア × 時間帯
    columns="timeframe",          # 列：時間足
    aggfunc="mean",               # 勝率
    observed=True
)

print(result)

#===================================================
#出力はこんな感じになります
#timeframe                  M1      M5     H1
#symbol  hour
#USDJPY  (21, 23]           0.52    0.48   0.55
...
#===================================================

#USDJPY の 21〜23時 の M5 の勝率が一発で見えるという状態になる。

#エラーが出たときにAIに相談する時のセリフおすすめ
#「このCSVで勝率を出したいけど、列がこうだからコードこう直したい。間違ってる？」