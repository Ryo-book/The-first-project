#参考　データサイエンスハンドブック P194

#この処理をすると、同じ銘柄なのに表記が違うものを全部同じに統一できます。


import pandas as pd

# 例データ
data = {
    "symbol": ["USDJPY", "usd_jpy", "USD/JPY", "eur_usd", "GBPJPY"],
    "date": ["2024-01-01", "2024-01-02", "2024-01-03", "2024-01-04", "2024-01-05"],
    "close": [110.0, 110.2, 110.1, 1.2, 150.0]
}

df = pd.DataFrame(data)

# ここがポイント
df["symbol"] = (
    df["symbol"]
    .str.replace("/", "")   # / を削除
    .str.replace("_", "")   # _ を削除
    .str.upper()            # 大文字に統一
)

df["date"] = pd.to_datetime(df["date"])  # 日付に変換
df = df.sort_values(["symbol", "date"])   # 通貨ペアごとにソート

print(df)



#========================================================================================
#同じ銘柄として扱えるので、

#通貨ペアごとの集計,通貨ペアごとのバックテスト,データの結合（merge）,まとめてインジケーター計算
#が 正しくできるようになります。
#========================================================================================

#使う機会があるケース

#① 複数ソースのデータを統合する時
#② 研究用に複数通貨ペアで一括バックテストする時
#③ 自分でデータを作る時（結構ある）